<!DOCTYPE html>
<html>
<head>
    <title>Virtue / Vice</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="../css/list.css">
    
    <!-- DC Pagination CSS -->
    <link type="text/css" rel="stylesheet" href="../css/tsc_pagination.css" />
    
    <script src="https://cdn.firebase.com/js/client/2.3.1/firebase.js"></script>
</head>
<body>
    <div>
    <section>
        <h1>Habit List</h1>
        <ul id="habit-list">
            <template id = "habits">
            <li>
                <input type="hidden" name="habit-id">
                <ul class="habit-info">
                    <li><div class="habit-name"></div>
                        <button type="button" class="op op-del" title="delete habit" onclick="deleteHabit(this)">
                        <img src="../img/delete.svg" alt="Del">
                        </button>
                    
                        <button type="button" class="op op-edit" onclick="location.href='edit.html'" title="edit habit">
                        <img src="../img/edit.svg" alt="Edit">
                        </button>
                    </li>
                    <li><img class="habit-icon" src="" alt="habit icon"></li>
                    <li><p class="habit-desc"></p></li>
                </ul>
                <div class="message">
                    <span class="message-total">
                        <strong >2</strong> days in a row! Best Record: <strong >5</strong><br>
                       <progress class="habit-progress" max="100" value="0"></progress>
                    </span><br>
                    <span visibility="hidden">Completed <strong id="habitCounter" class = "completed"></strong>/<strong id="habitStop" class = "totalNum"></strong> for today!</span>
                </div>
                <div class="habit-op">
                    <button type="button" class="op op-done" title="done" onclick ="done(this)"  value="0" data-count-stop="3">
                        <img src="../img/done.svg" alt="Done">
                    </button>
                </div>
            </li>
            </template>
        </ul>
        
        <div id="list-pagination">
            <ul class="tsc_pagination tsc_paginationB tsc_paginationB02">
                <li><a href="#" class="current">1</a></li>
                <li><a href="#">2</a></li>
                <li><a href="#">3</a></li>
                <li class="unavailable"><a href="">&hellip;</a></li>
                <li><a href="#" class="last">Last</a></li>
            </ul>
        </div>
    </section>

    </div>

    <button type="button" id="addHabit" onclick="location.href='add.html'" title="add habit">+</button>
    
    <script src="../js/list.js"></script>
    <script src="../js/notifications.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
   <script>
        
        function done(currentButton){
                        var oFirebaseRef = new Firebase('http://boiling-torch-2236.firebaseIO.com/web/habits');
            
            var habitTitle = currentButton.parentNode.previousElementSibling.previousElementSibling.firstElementChild.firstElementChild.innerHTML;
            console.log(habitTitle);
            oFirebaseRef.orderByChild("title").equalTo(habitTitle).once("value", function(snapshot){
                                                  
            currentButton.parentNode.previousElementSibling.firstElementChild.nextElementSibling.nextElementSibling.style.visibility= "visible";
                snapshot.forEach(function(childSnapshot){
                   var data = childSnapshot.val(); 
                    var index = 0;
                
               // console.log(data.sDaily_frequency);
                var countstop = data.daily_frequency;
                    
                var counter = data.numCompleted;
              
                var newCount = counter + 1;
                    //var ref = new Firebase('http://boiling-torch-2236.firebaseIO.com/web/habits');
                    console.log(oFirebaseRef.child(childSnapshot.key()).update({numCompleted : newCount}));
                   // console.log(childSnapshot.key());
                //$('.op-done').val(newCount);
                
                //display message
                //var msgElement = $('#habits').find(".message");
                //var msgToday = msgElement.find(".message-today");
               // $(".message-today").html("hello world!");
                if (newCount >= countstop) {
                    //message if habit is completed
                   currentButton.parentNode.previousElementSibling.firstElementChild.nextElementSibling.nextElementSibling.innerHTML = "Completed Habit!";
                    
                    
                }
                else {
                    //var habitCount = msgElement.find("#habitCounter");
                    currentButton.parentNode.previousElementSibling.firstElementChild.nextElementSibling.nextElementSibling.firstElementChild.innerHTML=newCount;
    //                $("#habitCounter").text(newCount);
                    
                    //var habitStop = msgElement.find("#habitStop");
                    currentButton.parentNode.previousElementSibling.firstElementChild.nextElementSibling.nextElementSibling.firstElementChild.nextElementSibling.innerHTML=countstop;
                }
                    });
                });
        }
    </script>
    

    <script>   
        // delete habit function
//        $(document).ready(function() {
//            $('.op-del').on('click', function() {
//                var x = confirm("Are you sure you want to delete this habit?");
//                if (x) {
//                    var child = $(this.parentNode.parentNode.parentNode)
//                    child.addClass(' animated fadeOutLeft');
//                    child.one('webkitAnimationEnd', function(event) {
//                        $(this).remove(); 
//                    });                
//                }
//                else
//                    return false;
//            });
//            
//        });
        
        function deleteHabit(element) {
            var x = confirm("Are you sure you want to delete this habit?");
            
            if (x) {
                var child = element.parentNode.parentNode.parentNode;
                child.className = child.className + " animated fadeOutLeft";
                $(child).one('webkitAnimationEnd', function(event) {
                    $(this).remove();
                });
            }
            else
                return false;
        }
        
        
    </script>
<script>
var oFirebaseRef = new Firebase('http://boiling-torch-2236.firebaseIO.com/web/');

window.onload = function()
        {

            var habitList = document.getElementById("habit-list");
            var index = 0;
            oFirebaseRef.child("habits").once("value", function(snapshot){
            var sBestRecords = [];
            var sDaily_frequencys = [];
            var sDaysInARows = [];
            var sDescriptions = [];
            var sIcons = [];
            var sTitles = [];
            var sWeekly_frequencys = [];
            var sNumCompleted = [];
            var sTotalTodays = [];
            
     snapshot.forEach(function(childSnapshot){
                
                var data = childSnapshot.val();
                sBestRecords[index] = data.bestRecord;
                sDaily_frequencys[index] = data.daily_frequency;
                sDaysInARows[index] = data.daysInARow;
                sDescriptions[index] = data.description;
                sIcons[index] = data.icon;
                sTitles[index] = data.title;
                sWeekly_frequencys[index] = data.weekly_frequency;
                sNumCompleted[index] = data.numCompleted;
                
                console.log(index);
                index++;

                
          });
               
                for(i = 0; i<index; i++){
                    var habitListItem = document.getElementById("habits").content.cloneNode(true);
                    habitList.appendChild(habitListItem);
                    console.log(document.getElementsByClassName("habit-name")[i].innerHTML = sTitles[i]);
                    console.log(document.getElementsByClassName("habit-icon")[i].src = sIcons[i]);
                    console.log(document.getElementsByClassName("habit-desc")[i].innerHTML = sDescriptions[i]);
                    console.log(document.getElementsByClassName("completed")[i].innerHTML = sNumCompleted[i]);
                    console.log(document.getElementsByClassName("totalNum")[i].innerHTML = sDaily_frequencys[i]);
                    
              
                }
                

        });
        
            
        }   
</script>
    

</body>
</html>